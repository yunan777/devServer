#!/bin/bash

cd "$(dirname $0)"

compose_file="./stuck.yaml"

function start() 
{
    docker-compose -f $compose_file up -d
}

function stop()
{
    docker-compose -f $compose_file down
}

case $1 in
"build")
    mkdir -p ./www && chgrp 33 ./www && chmod g+s ./www && mkdir -p ./www/html && touch ./www/html/do_not_delete
    mkdir -p ./data/mysql ./data/caddy/data ./data/caddy/config ./data/redis ./log/nginx ./log/caddy
    docker-compose -f $compose_file build php-fpm workspace
    docker-compose -f $compose_file pull nginx mysql caddy redis
    docker-compose -f $compose_file up -d mysql
    docker-compose -f $compose_file logs mysql | grep "PASSWORD"
    docker-compose -f $compose_file down mysql
;;
"start")
    start
;;
"dev")
    docker-compose -f $compose_file run --rm workspace
;;
"stop")
    stop
;;
"restart")
    stop
    start
;;
*)
    echo "Usage: ./server [build|start|dev|stop|restart]"
;;
esac
